name: Deploy to Render

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Trigger Render deployment
        run: |
          echo "âœ… Code pushed to main - Render will auto-deploy"
          echo "ğŸ“ Backend: https://tradingpool-backend.onrender.com"
          echo "ğŸ“ Frontend: https://tradingpool-frontend.onrender.com"
          echo "ğŸ“š API Docs: https://tradingpool-backend.onrender.com/api/docs"
      
      - name: Wait for deployment
        run: sleep 60
      
      - name: Health check backend
        run: |
          for i in {1..10}; do
            if curl -f https://tradingpool-backend.onrender.com/health; then
              echo "âœ… Backend is healthy"
              exit 0
            fi
            echo "â³ Waiting for backend... (attempt $i/10)"
            sleep 30
          done
          echo "âŒ Backend health check failed"
          exit 1
      
      - name: Health check frontend
        run: |
          if curl -f https://tradingpool-frontend.onrender.com; then
            echo "âœ… Frontend is healthy"
          else
            echo "âš ï¸ Frontend health check failed"
            exit 1
          fi
      
      - name: Deployment summary
        if: success()
        run: |
          echo "ğŸ‰ Deployment successful!"
          echo ""
          echo "ğŸ“ URLs:"
          echo "  - Frontend: https://tradingpool-frontend.onrender.com"
          echo "  - Backend API: https://tradingpool-backend.onrender.com/api/v1"
          echo "  - API Docs: https://tradingpool-backend.onrender.com/api/docs"
          echo ""
          echo "ğŸ” Admin Login:"
          echo "  - Email: sesshomaru@admin.com"
          echo "  - Password: inyasha"
